<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatApp</title>
    <style>
        :root {
            --bg-color: #1e1e2e;
            --sidebar-color: #181825;
            --text-color: #cdd6f4;
            --accent-color: #89b4fa;
            --hover-color: #313244;
            --success-color: #a6e3a1;
            --error-color: #f38ba8;
            --input-bg: #313244;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Auth Screen */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: var(--bg-color);
        }

        .auth-form {
            background-color: var(--sidebar-color);
            padding: 2rem;
            border-radius: 10px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .auth-form h2 {
            margin-bottom: 1.5rem;
            text-align: center;
            color: var(--accent-color);
        }

        .auth-form input {
            width: 100%;
            padding: 0.75rem;
            margin-bottom: 1rem;
            border: none;
            border-radius: 5px;
            background-color: var(--input-bg);
            color: var(--text-color);
        }

        .auth-form button {
            width: 100%;
            padding: 0.75rem;
            background-color: var(--accent-color);
            color: var(--sidebar-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .auth-form button:hover {
            opacity: 0.9;
        }

        .auth-switch {
            text-align: center;
            color: var(--accent-color);
            cursor: pointer;
            margin-top: 1rem;
        }

        .error-message {
            color: var(--error-color);
            margin-bottom: 1rem;
            text-align: center;
        }

        /* Main App */
        .app-container {
            display: none;
            height: 100vh;
            overflow: hidden;
        }

        .app-header {
            background-color: var(--sidebar-color);
            padding: 1rem;
            text-align: center;
            font-weight: bold;
            border-bottom: 1px solid var(--hover-color);
        }

        .app-content {
            display: flex;
            height: calc(100vh - 60px);
        }

        .sidebar {
            width: 250px;
            background-color: var(--sidebar-color);
            border-right: 1px solid var(--hover-color);
            padding: 1rem;
            overflow-y: auto;
        }

        .sidebar-item {
            padding: 0.75rem;
            border-radius: 5px;
            margin-bottom: 0.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
        }

        .sidebar-item:hover {
            background-color: var(--hover-color);
        }

        .sidebar-item.active {
            background-color: var(--accent-color);
            color: var(--sidebar-color);
        }

        .sidebar-item i {
            margin-right: 0.5rem;
        }

        .main-content {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
        }

        /* Profile Tab */
        .profile-info {
            max-width: 600px;
            margin: 0 auto;
        }

        .profile-info h2 {
            margin-bottom: 1rem;
            color: var(--accent-color);
        }

        .profile-field {
            margin-bottom: 1rem;
        }

        .profile-field label {
            display: block;
            margin-bottom: 0.25rem;
            color: var(--accent-color);
        }

        .profile-field input {
            width: 100%;
            padding: 0.5rem;
            background-color: var(--input-bg);
            border: none;
            border-radius: 5px;
            color: var(--text-color);
        }

        /* Friends Tab */
        .friends-search {
            margin-bottom: 1rem;
        }

        .friends-search input {
            width: 100%;
            padding: 0.5rem;
            background-color: var(--input-bg);
            border: none;
            border-radius: 5px;
            color: var(--text-color);
            margin-bottom: 0.5rem;
        }

        .friends-search button {
            padding: 0.5rem 1rem;
            background-color: var(--accent-color);
            color: var(--sidebar-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .friends-list {
            margin-top: 1rem;
        }

        .friend-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background-color: var(--input-bg);
            border-radius: 5px;
            margin-bottom: 0.5rem;
        }

        .friend-actions button {
            margin-left: 0.5rem;
            padding: 0.25rem 0.5rem;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

        .friend-actions .chat-btn {
            background-color: var(--accent-color);
            color: var(--sidebar-color);
        }

        .friend-actions .remove-btn {
            background-color: var(--error-color);
            color: white;
        }

        /* Notifications Tab */
        .notification-item {
            padding: 0.75rem;
            background-color: var(--input-bg);
            border-radius: 5px;
            margin-bottom: 0.5rem;
        }

        .notification-message {
            margin-bottom: 0.5rem;
        }

        .notification-actions button {
            margin-right: 0.5rem;
            padding: 0.25rem 0.5rem;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

        .notification-actions .accept-btn {
            background-color: var(--success-color);
            color: var(--sidebar-color);
        }

        .notification-actions .block-btn {
            background-color: var(--error-color);
            color: white;
        }

        .notification-actions .dismiss-btn {
            background-color: var(--input-bg);
            color: var(--text-color);
            border: 1px solid var(--text-color);
        }

        /* Chat Tab */
        .chat-container {
            display: flex;
            height: calc(100vh - 120px);
        }

        .chat-friends {
            width: 250px;
            border-right: 1px solid var(--hover-color);
            overflow-y: auto;
            padding-right: 1rem;
        }

        .chat-messages {
            flex: 1;
            padding: 0 1rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .chat-friend-item {
            padding: 0.75rem;
            border-radius: 5px;
            margin-bottom: 0.5rem;
            cursor: pointer;
        }

        .chat-friend-item:hover {
            background-color: var(--hover-color);
        }

        .chat-friend-item.active {
            background-color: var(--accent-color);
            color: var(--sidebar-color);
        }

        .message {
            max-width: 70%;
            padding: 0.75rem;
            border-radius: 10px;
            margin-bottom: 0.75rem;
            word-wrap: break-word;
        }

        .message-outgoing {
            align-self: flex-end;
            background-color: var(--accent-color);
            color: var(--sidebar-color);
        }

        .message-incoming {
            align-self: flex-start;
            background-color: var(--input-bg);
        }

        .chat-input {
            display: flex;
            margin-top: auto;
            padding: 1rem 0;
        }

        .chat-input input {
            flex: 1;
            padding: 0.75rem;
            background-color: var(--input-bg);
            border: none;
            border-radius: 5px;
            color: var(--text-color);
            margin-right: 0.5rem;
        }

        .chat-input button {
            padding: 0.75rem 1.5rem;
            background-color: var(--accent-color);
            color: var(--sidebar-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .app-content {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
                border-right: none;
                border-bottom: 1px solid var(--hover-color);
            }

            .chat-container {
                flex-direction: column;
                height: auto;
            }

            .chat-friends {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid var(--hover-color);
                margin-bottom: 1rem;
                padding-bottom: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Auth Screen -->
    <div class="auth-container" id="auth-container">
        <div class="auth-form">
            <h2 id="auth-title">Login</h2>
            <div class="error-message" id="error-message"></div>
            <input type="text" id="username" placeholder="Username">
            <input type="password" id="password" placeholder="Password">
            <button id="auth-button">Login</button>
            <div class="auth-switch" id="auth-switch">Don't have an account? Register</div>
        </div>
    </div>

    <!-- Main App -->
    <div class="app-container" id="app-container">
        <div class="app-header">
            ChatApp
        </div>
        <div class="app-content">
            <div class="sidebar">
                <div class="sidebar-item" data-tab="profile">
                    <i>👤</i> Profile
                </div>
                <div class="sidebar-item" data-tab="chat">
                    <i>💬</i> Chat
                </div>
                <div class="sidebar-item" data-tab="friends">
                    <i>👥</i> Friends
                </div>
                <div class="sidebar-item" data-tab="notifications">
                    <i>🔔</i> Notifications
                </div>
                <div class="sidebar-item" id="logout-button">
                    <i>🚪</i> Logout
                </div>
            </div>
            <div class="main-content" id="main-content">
                <!-- Content will be loaded here based on tab selection -->
            </div>
        </div>
    </div>

    <script>
        // Data structure for users
        const usersDB = 'chatAppUsers';
        const currentUserKey = 'chatAppCurrentUser';
        
        // BroadcastChannel for multi-tab sync
        const broadcastChannel = new BroadcastChannel('chatAppUpdates');

        // Generate a 20-digit unique ID
        function generateId() {
            return Array.from({length: 20}, () => Math.floor(Math.random() * 10)).join('');
        }

        // Get all users from localStorage
        function getAllUsers() {
            const users = localStorage.getItem(usersDB);
            return users ? JSON.parse(users) : {};
        }

        // Save all users to localStorage
        function saveAllUsers(users) {
            localStorage.setItem(usersDB, JSON.stringify(users));
            broadcastChannel.postMessage({type: 'dataUpdate'});
        }

        // Get current user from localStorage
        function getCurrentUser() {
            const username = localStorage.getItem(currentUserKey);
            if (!username) return null;
            
            const users = getAllUsers();
            return users[username] || null;
        }

        // Set current user in localStorage
        function setCurrentUser(username) {
            localStorage.setItem(currentUserKey, username);
        }

        // Clear current user (logout)
        function clearCurrentUser() {
            localStorage.removeItem(currentUserKey);
        }

        // Register a new user
        function register(username, password) {
            const users = getAllUsers();
            
            if (users[username]) {
                return {success: false, message: 'Username already exists'};
            }
            
            const userId = generateId();
            users[username] = {
                username,
                password,
                id: userId,
                friends: [],
                chats: {},
                notifications: []
            };
            
            saveAllUsers(users);
            return {success: true};
        }

        // Login a user
        function login(username, password) {
            const users = getAllUsers();
            const user = users[username];
            
            if (!user) {
                return {success: false, message: 'User not found'};
            }
            
            if (user.password !== password) {
                return {success: false, message: 'Incorrect password'};
            }
            
            setCurrentUser(username);
            return {success: true};
        }

        // Send a friend request
        function sendFriendRequest(receiverId) {
            const currentUser = getCurrentUser();
            if (!currentUser) return {success: false, message: 'Not logged in'};
            
            const users = getAllUsers();
            let receiver = null;
            
            // Find user by ID
            for (const username in users) {
                if (users[username].id === receiverId) {
                    receiver = users[username];
                    break;
                }
            }
            
            if (!receiver) {
                return {success: false, message: 'User not found'};
            }
            
            if (receiver.username === currentUser.username) {
                return {success: false, message: 'Cannot add yourself'};
            }
            
            if (currentUser.friends.includes(receiver.username)) {
                return {success: false, message: 'Already friends'};
            }
            
            // Check if request already exists
            const existingRequest = receiver.notifications.find(
                n => n.type === 'friendRequest' && n.from === currentUser.username
            );
            
            if (existingRequest) {
                return {success: false, message: 'Request already sent'};
            }
            
            // Add notification to receiver
            receiver.notifications.push({
                type: 'friendRequest',
                from: currentUser.username
            });
            
            users[receiver.username] = receiver;
            saveAllUsers(users);
            
            return {success: true};
        }

        // Handle friend request response
        function handleFriendRequest(fromUsername, action) {
            const currentUser = getCurrentUser();
            if (!currentUser) return {success: false, message: 'Not logged in'};
            
            const users = getAllUsers();
            const sender = users[fromUsername];
            
            if (!sender) {
                return {success: false, message: 'User not found'};
            }
            
            // Remove the notification
            currentUser.notifications = currentUser.notifications.filter(
                n => !(n.type === 'friendRequest' && n.from === fromUsername)
            );
            
            if (action === 'accept') {
                // Add each other as friends if not already
                if (!currentUser.friends.includes(fromUsername)) {
                    currentUser.friends.push(fromUsername);
                }
                
                if (!sender.friends.includes(currentUser.username)) {
                    sender.friends.push(currentUser.username);
                }
                
                // Initialize chat if it doesn't exist
                if (!currentUser.chats[fromUsername]) {
                    currentUser.chats[fromUsername] = [];
                }
                
                if (!sender.chats[currentUser.username]) {
                    sender.chats[currentUser.username] = [];
                }
            } else if (action === 'block') {
                // Add to blocked list (to be implemented)
            }
            
            // Update both users
            users[currentUser.username] = currentUser;
            users[fromUsername] = sender;
            saveAllUsers(users);
            
            return {success: true};
        }

        // Send a message to a friend
        function sendMessage(friendUsername, messageText) {
            const currentUser = getCurrentUser();
            if (!currentUser) return {success: false, message: 'Not logged in'};
            
            const users = getAllUsers();
            const friend = users[friendUsername];
            
            if (!friend) {
                return {success: false, message: 'Friend not found'};
            }
            
            if (!currentUser.friends.includes(friendUsername)) {
                return {success: false, message: 'Not friends'};
            }
            
            // Add message to current user's chat
            if (!currentUser.chats[friendUsername]) {
                currentUser.chats[friendUsername] = [];
            }
            
            currentUser.chats[friendUsername].push({
                from: currentUser.username,
                text: messageText,
                timestamp: new Date().toISOString()
            });
            
            // Add message to friend's chat
            if (!friend.chats[currentUser.username]) {
                friend.chats[currentUser.username] = [];
            }
            
            friend.chats[currentUser.username].push({
                from: currentUser.username,
                text: messageText,
                timestamp: new Date().toISOString()
            });
            
            // Update both users
            users[currentUser.username] = currentUser;
            users[friendUsername] = friend;
            saveAllUsers(users);
            
            return {success: true};
        }

        // UI Functions
        function showAuthScreen() {
            document.getElementById('auth-container').style.display = 'flex';
            document.getElementById('app-container').style.display = 'none';
            clearCurrentUser();
        }

        function showAppScreen() {
            document.getElementById('auth-container').style.display = 'none';
            document.getElementById('app-container').style.display = 'block';
            loadTab('profile');
        }

        function loadTab(tabName) {
            const mainContent = document.getElementById('main-content');
            const currentUser = getCurrentUser();
            
            if (!currentUser) {
                showAuthScreen();
                return;
            }
            
            // Update active tab in sidebar
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.tab === tabName) {
                    item.classList.add('active');
                }
            });
            
            switch (tabName) {
                case 'profile':
                    mainContent.innerHTML = `
                        <div class="profile-info">
                            <h2>Profile</h2>
                            <div class="profile-field">
                                <label>Username</label>
                                <input type="text" value="${currentUser.username}" readonly>
                            </div>
                            <div class="profile-field">
                                <label>User ID</label>
                                <input type="text" value="${currentUser.id}" readonly>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'friends':
                    mainContent.innerHTML = `
                        <div class="friends-search">
                            <h2>Friends</h2>
                            <input type="text" id="friend-id-input" placeholder="Enter friend's ID">
                            <button id="send-request-button">Send Friend Request</button>
                        </div>
                        <div class="friends-list" id="friends-list">
                            ${currentUser.friends.map(friend => `
                                <div class="friend-item">
                                    <span>${friend}</span>
                                    <div class="friend-actions">
                                        <button class="chat-btn" data-friend="${friend}">Chat</button>
                                        <button class="remove-btn" data-friend="${friend}">Remove</button>
                                    </div>
                                </div>
                            `).join('') || '<p>No friends yet. Add some!</p>'}
                        </div>
                    `;
                    
                    document.getElementById('send-request-button').addEventListener('click', () => {
                        const friendId = document.getElementById('friend-id-input').value;
                        const result = sendFriendRequest(friendId);
                        
                        if (result.success) {
                            alert('Friend request sent!');
                            document.getElementById('friend-id-input').value = '';
                            loadTab('friends');
                        } else {
                            alert(result.message);
                        }
                    });
                    
                    document.querySelectorAll('.friend-actions .chat-btn').forEach(button => {
                        button.addEventListener('click', (e) => {
                            const friend = e.target.dataset.friend;
                            loadChat(friend);
                        });
                    });
                    
                    document.querySelectorAll('.friend-actions .remove-btn').forEach(button => {
                        button.addEventListener('click', (e) => {
                            const friend = e.target.dataset.friend;
                            removeFriend(friend);
                        });
                    });
                    break;
                    
                case 'notifications':
                    mainContent.innerHTML = `
                        <h2>Notifications</h2>
                        <div id="notifications-list">
                            ${currentUser.notifications.map(notification => {
                                if (notification.type === 'friendRequest') {
                                    return `
                                        <div class="notification-item">
                                            <div class="notification-message">
                                                ${notification.from} wants to be your friend
                                            </div>
                                            <div class="notification-actions">
                                                <button class="accept-btn" data-from="${notification.from}">Accept</button>
                                                <button class="block-btn" data-from="${notification.from}">Block</button>
                                                <button class="dismiss-btn" data-from="${notification.from}">Dismiss</button>
                                            </div>
                                        </div>
                                    `;
                                }
                                return '';
                            }).join('') || '<p>No notifications</p>'}
                        </div>
                    `;
                    
                    document.querySelectorAll('.accept-btn').forEach(button => {
                        button.addEventListener('click', (e) => {
                            const from = e.target.dataset.from;
                            handleFriendRequest(from, 'accept');
                            loadTab('notifications');
                        });
                    });
                    
                    document.querySelectorAll('.block-btn').forEach(button => {
                        button.addEventListener('click', (e) => {
                            const from = e.target.dataset.from;
                            handleFriendRequest(from, 'block');
                            loadTab('notifications');
                        });
                    });
                    
                    document.querySelectorAll('.dismiss-btn').forEach(button => {
                        button.addEventListener('click', (e) => {
                            const from = e.target.dataset.from;
                            handleFriendRequest(from, 'dismiss');
                            loadTab('notifications');
                        });
                    });
                    break;
                    
                case 'chat':
                    mainContent.innerHTML = `
                        <div class="chat-container">
                            <div class="chat-friends" id="chat-friends">
                                ${currentUser.friends.map(friend => `
                                    <div class="chat-friend-item" data-friend="${friend}">
                                        ${friend}
                                    </div>
                                `).join('') || '<p>No friends to chat with</p>'}
                            </div>
                            <div class="chat-messages" id="chat-messages">
                                <p>Select a friend to start chatting</p>
                            </div>
                        </div>
                        <div class="chat-input" id="chat-input" style="display: none;">
                            <input type="text" id="message-input" placeholder="Type a message...">
                            <button id="send-message-button">Send</button>
                        </div>
                    `;
                    
                    document.querySelectorAll('.chat-friend-item').forEach(item => {
                        item.addEventListener('click', (e) => {
                            const friend = e.target.dataset.friend;
                            loadChat(friend);
                        });
                    });
                    break;
            }
        }

        function loadChat(friendUsername) {
            const currentUser = getCurrentUser();
            if (!currentUser) return;
            
            const chatMessages = document.getElementById('chat-messages');
            const chatInput = document.getElementById('chat-input');
            
            if (!chatMessages || !chatInput) {
                loadTab('chat');
                setTimeout(() => loadChat(friendUsername), 100);
                return;
            }
            
            // Update active friend in list
            document.querySelectorAll('.chat-friend-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.friend === friendUsername) {
                    item.classList.add('active');
                }
            });
            
            // Display messages
            const messages = currentUser.chats[friendUsername] || [];
            chatMessages.innerHTML = messages.map(msg => {
                const isOutgoing = msg.from === currentUser.username;
                return `
                    <div class="message ${isOutgoing ? 'message-outgoing' : 'message-incoming'}">
                        ${msg.text}
                    </div>
                `;
            }).join('');
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Show input and set up event listener
            chatInput.style.display = 'flex';
            const messageInput = document.getElementById('message-input');
            const sendButton = document.getElementById('send-message-button');
            
            // Clear existing event listeners
            const newSendButton = sendButton.cloneNode(true);
            sendButton.parentNode.replaceChild(newSendButton, sendButton);
            
            newSendButton.addEventListener('click', () => {
                const messageText = messageInput.value.trim();
                if (messageText) {
                    sendMessage(friendUsername, messageText);
                    messageInput.value = '';
                    loadChat(friendUsername);
                }
            });
            
            messageInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const messageText = messageInput.value.trim();
                    if (messageText) {
                        sendMessage(friendUsername, messageText);
                        messageInput.value = '';
                        loadChat(friendUsername);
                    }
                }
            });
            
            // Focus input
            messageInput.focus();
        }

        function removeFriend(friendUsername) {
            const currentUser = getCurrentUser();
            if (!currentUser) return;
            
            const users = getAllUsers();
            const friend = users[friendUsername];
            
            if (!friend) return;
            
            // Remove from current user's friends
            currentUser.friends = currentUser.friends.filter(f => f !== friendUsername);
            
            // Remove from friend's friends
            if (friend.friends) {
                friend.friends = friend.friends.filter(f => f !== currentUser.username);
            }
            
            // Update both users
            users[currentUser.username] = currentUser;
            users[friendUsername] = friend;
            saveAllUsers(users);
            
            // Reload friends tab
            loadTab('friends');
        }

        // Initialize the app
        function initApp() {
            // Check if user is logged in
            const currentUser = getCurrentUser();
            if (currentUser) {
                showAppScreen();
            } else {
                showAuthScreen();
            }
            
            // Auth screen setup
            const authTitle = document.getElementById('auth-title');
            const authButton = document.getElementById('auth-button');
            const authSwitch = document.getElementById('auth-switch');
            const errorMessage = document.getElementById('error-message');
            
            let isLogin = true;
            
            function updateAuthUI() {
                if (isLogin) {
                    authTitle.textContent = 'Login';
                    authButton.textContent = 'Login';
                    authSwitch.textContent = 'Don\'t have an account? Register';
                } else {
                    authTitle.textContent = 'Register';
                    authButton.textContent = 'Register';
                    authSwitch.textContent = 'Already have an account? Login';
                }
                errorMessage.textContent = '';
            }
            
            authSwitch.addEventListener('click', () => {
                isLogin = !isLogin;
                updateAuthUI();
            });
            
            authButton.addEventListener('click', () => {
                const username = document.getElementById('username').value.trim();
                const password = document.getElementById('password').value.trim();
                
                if (!username || !password) {
                    errorMessage.textContent = 'Please enter both username and password';
                    return;
                }
                
                if (isLogin) {
                    const result = login(username, password);
                    if (result.success) {
                        showAppScreen();
                    } else {
                        errorMessage.textContent = result.message;
                    }
                } else {
                    const result = register(username, password);
                    if (result.success) {
                        errorMessage.textContent = 'Registration successful! Please login.';
                        isLogin = true;
                        updateAuthUI();
                    } else {
                        errorMessage.textContent = result.message;
                    }
                }
            });
            
            // App setup
            document.querySelectorAll('.sidebar-item[data-tab]').forEach(item => {
                item.addEventListener('click', () => {
                    const tabName = item.dataset.tab;
                    loadTab(tabName);
                });
            });
            
            document.getElementById('logout-button').addEventListener('click', () => {
                clearCurrentUser();
                showAuthScreen();
            });
            
            // Handle tab changes from URL hash
            window.addEventListener('hashchange', () => {
                const tabName = window.location.hash.substring(1);
                if (tabName) {
                    loadTab(tabName);
                }
            });
            
            // Listen for data updates from other tabs
            broadcastChannel.addEventListener('message', (event) => {
                if (event.data.type === 'dataUpdate') {
                    // Reload current tab to reflect changes
                    const currentTab = document.querySelector('.sidebar-item.active')?.dataset.tab;
                    if (currentTab) {
                        loadTab(currentTab);
                    }
                }
            });
            
            // Initial tab load
            if (currentUser) {
                const initialTab = window.location.hash.substring(1) || 'profile';
                loadTab(initialTab);
            }
            
            updateAuthUI();
        }

        // Start the app
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
